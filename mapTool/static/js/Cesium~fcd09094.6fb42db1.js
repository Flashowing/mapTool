(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Cesium~fcd09094"],{"026e":function(t,e,a){"use strict";var n=a("2f63"),i=a("abab"),r=a("1b8d"),o=a("1da3"),s=a("a141"),c=a("1eae"),d=a("d62b"),u=a("f23e"),_=a("ef54"),T=a("60e0"),I=a("d887");const S={};function l(t,e,a,i){const r=t.shaderBuilder,o=T["a"].getAttributeInfo(e);i>1?f(t,e,a,i):E(t,e,a),m(r,o),N(r,o),Object(n["a"])(e.semantic)&&A(r,e),b(r,o),p(r,o),F(r,o)}function A(t,e){const a=e.semantic,n=e.setIndex;switch(a){case s["a"].NORMAL:t.addDefine("HAS_NORMALS");break;case s["a"].TANGENT:t.addDefine("HAS_TANGENTS");break;case s["a"].FEATURE_ID:t.addDefine(`HAS${a}_${n}`);break;case s["a"].TEXCOORD:case s["a"].COLOR:t.addDefine(`HAS_${a}_${n}`)}}function E(t,e,a){const i=e.quantization;let r,c;Object(n["a"])(i)?(r=i.type,c=i.componentDatatype):(r=e.type,c=e.componentDatatype);const d=e.semantic,u=e.setIndex;d===s["a"].FEATURE_ID&&u>=t.featureIdVertexAttributeSetIndex&&(t.featureIdVertexAttributeSetIndex=u+1);const _={index:a,value:Object(n["a"])(e.buffer)?void 0:e.constant,vertexBuffer:e.buffer,count:e.count,componentsPerAttribute:o["a"].getNumberOfComponents(r),componentDatatype:c,offsetInBytes:e.byteOffset,strideInBytes:e.byteStride,normalize:e.normalized};t.attributes.push(_)}function f(t,e,a,r){const s=e.quantization;let c,d;Object(n["a"])(s)?(c=s.type,d=s.componentDatatype):(c=e.type,d=e.componentDatatype);const u=e.normalized,_=o["a"].getNumberOfComponents(c),T=_/r,I=i["a"].getSizeInBytes(d),S=T*I,l=e.byteStride;for(let n=0;n<r;n++){const i=e.byteOffset+n*S,r={index:a+n,vertexBuffer:e.buffer,componentsPerAttribute:T,componentDatatype:d,offsetInBytes:i,strideInBytes:l,normalize:u};t.attributes.push(r)}}function N(t,e){const a=e.variableName;let n,i="v_"+a;"normalMC"===a?(i="v_normalEC",n=e.glslType):"tangentMC"===a?(n="vec3",i="v_tangentEC"):n=e.glslType,t.addVarying(n,i)}function m(t,e){const a=e.attribute.semantic,n=e.variableName;let i,r;e.isQuantized?(i="a_quantized_"+n,r=e.quantizedGlslType):(i="a_"+n,r=e.glslType),a===s["a"].POSITION?t.setPositionAttribute(r,i):t.addAttribute(r,i)}function b(t,e){const a=S.STRUCT_ID_PROCESSED_ATTRIBUTES_VS,n=S.STRUCT_ID_PROCESSED_ATTRIBUTES_FS,i=e.variableName;"tangentMC"===i?(t.addStructField(a,"vec3","tangentMC"),t.addStructField(a,"float","tangentSignMC"),t.addStructField(n,"vec3","tangentEC")):"normalMC"===i?(t.addStructField(a,"vec3","normalMC"),t.addStructField(n,"vec3","normalEC")):(t.addStructField(a,e.glslType,i),t.addStructField(n,e.glslType,i))}function p(t,e){if(e.isQuantized)return;const a=S.FUNCTION_ID_INITIALIZE_ATTRIBUTES,n=e.variableName,i=[];"tangentMC"===n?(i.push("attributes.tangentMC = a_tangentMC.xyz;"),i.push("attributes.tangentSignMC = a_tangentMC.w;")):i.push(`attributes.${n} = a_${n};`),t.addFunctionLines(a,i)}function F(t,e){const a=e.attribute.semantic,i=e.attribute.setIndex;if(Object(n["a"])(a)&&!Object(n["a"])(i))return;let r=S.FUNCTION_ID_SET_DYNAMIC_VARYINGS_VS;const o=e.variableName;let s=`v_${o} = attributes.${o};`;t.addFunctionLines(r,[s]),r=S.FUNCTION_ID_SET_DYNAMIC_VARYINGS_FS,s=`attributes.${o} = v_${o};`,t.addFunctionLines(r,[s])}function R(t,e){let a=!1,n=!1;for(let i=0;i<e.length;i++){const t=e[i];t.semantic===s["a"].NORMAL?a=!0:t.semantic===s["a"].TANGENT&&(n=!0)}a&&n&&(t.addDefine("HAS_BITANGENTS"),t.addVarying("vec3","v_bitangentEC"),t.addStructField(S.STRUCT_ID_PROCESSED_ATTRIBUTES_VS,"vec3","bitangentMC"),t.addStructField(S.STRUCT_ID_PROCESSED_ATTRIBUTES_FS,"vec3","bitangentEC"))}S.name="GeometryPipelineStage",S.STRUCT_ID_PROCESSED_ATTRIBUTES_VS="ProcessedAttributesVS",S.STRUCT_ID_PROCESSED_ATTRIBUTES_FS="ProcessedAttributesFS",S.STRUCT_NAME_PROCESSED_ATTRIBUTES="ProcessedAttributes",S.FUNCTION_ID_INITIALIZE_ATTRIBUTES="initializeAttributes",S.FUNCTION_SIGNATURE_INITIALIZE_ATTRIBUTES="void initializeAttributes(out ProcessedAttributes attributes)",S.FUNCTION_ID_SET_DYNAMIC_VARYINGS_VS="setDynamicVaryingsVS",S.FUNCTION_ID_SET_DYNAMIC_VARYINGS_FS="setDynamicVaryingsFS",S.FUNCTION_SIGNATURE_SET_DYNAMIC_VARYINGS="void setDynamicVaryings(inout ProcessedAttributes attributes)",S.process=function(t,e){const a=t.shaderBuilder;a.addStruct(S.STRUCT_ID_PROCESSED_ATTRIBUTES_VS,"ProcessedAttributes",_["a"].VERTEX),a.addStruct(S.STRUCT_ID_PROCESSED_ATTRIBUTES_FS,"ProcessedAttributes",_["a"].FRAGMENT),a.addStruct(u["a"].STRUCT_ID_SELECTED_FEATURE,u["a"].STRUCT_NAME_SELECTED_FEATURE,_["a"].BOTH),a.addFunction(S.FUNCTION_ID_INITIALIZE_ATTRIBUTES,S.FUNCTION_SIGNATURE_INITIALIZE_ATTRIBUTES,_["a"].VERTEX),a.addVarying("vec3","v_positionWC"),a.addVarying("vec3","v_positionEC"),a.addStructField(S.STRUCT_ID_PROCESSED_ATTRIBUTES_FS,"vec3","positionWC"),a.addStructField(S.STRUCT_ID_PROCESSED_ATTRIBUTES_FS,"vec3","positionEC"),a.addFunction(S.FUNCTION_ID_SET_DYNAMIC_VARYINGS_VS,S.FUNCTION_SIGNATURE_SET_DYNAMIC_VARYINGS,_["a"].VERTEX),a.addFunction(S.FUNCTION_ID_SET_DYNAMIC_VARYINGS_FS,S.FUNCTION_SIGNATURE_SET_DYNAMIC_VARYINGS,_["a"].FRAGMENT);const n=t.model.type;n===I["a"].TILE_PNTS&&a.addDefine("HAS_SRGB_COLOR",void 0,_["a"].FRAGMENT);for(let i=0;i<e.attributes.length;i++){const a=e.attributes[i],n=o["a"].getAttributeLocationCount(a.type);let r;n>1?(r=t.attributeIndex,t.attributeIndex+=n):r=a.semantic===s["a"].POSITION?0:t.attributeIndex++,l(t,a,r,n)}R(a,e.attributes),e.primitiveType===r["a"].POINTS&&a.addDefine("PRIMITIVE_TYPE_POINTS"),a.addVertexLines([d["a"]]),a.addFragmentLines([c["a"]])},e["a"]=S},"0e94":function(t,e,a){"use strict";var n=a("2bb9"),i=a("2f63"),r=a("2ed4"),o=a("ef54"),s=a("1b40");const c={name:"ImageBasedLightingPipelineStage",process:function(t,e,a){const c=e.imageBasedLighting,d=t.shaderBuilder;if(d.addDefine("USE_IBL_LIGHTING",void 0,o["a"].FRAGMENT),d.addUniform("vec2","model_iblFactor",o["a"].FRAGMENT),s["a"].isSupported(a.context)){const t=c.useSphericalHarmonics||c.useSpecularEnvironmentMaps||c.enabled;t&&d.addUniform("mat3","model_iblReferenceFrameMatrix",o["a"].FRAGMENT),Object(i["a"])(c.sphericalHarmonicCoefficients)?(d.addDefine("DIFFUSE_IBL",void 0,o["a"].FRAGMENT),d.addDefine("CUSTOM_SPHERICAL_HARMONICS",void 0,o["a"].FRAGMENT),d.addUniform("vec3","model_sphericalHarmonicCoefficients[9]",o["a"].FRAGMENT)):c.useDefaultSphericalHarmonics&&d.addDefine("DIFFUSE_IBL",void 0,o["a"].FRAGMENT),Object(i["a"])(c.specularEnvironmentMapAtlas)&&c.specularEnvironmentMapAtlas.ready?(d.addDefine("SPECULAR_IBL",void 0,o["a"].FRAGMENT),d.addDefine("CUSTOM_SPECULAR_IBL",void 0,o["a"].FRAGMENT),d.addUniform("sampler2D","model_specularEnvironmentMaps",o["a"].FRAGMENT),d.addUniform("vec2","model_specularEnvironmentMapsSize",o["a"].FRAGMENT),d.addUniform("float","model_specularEnvironmentMapsMaximumLOD",o["a"].FRAGMENT)):e.useDefaultSpecularMaps&&d.addDefine("SPECULAR_IBL",void 0,o["a"].FRAGMENT)}Object(i["a"])(c.luminanceAtZenith)&&(d.addDefine("USE_SUN_LUMINANCE",void 0,o["a"].FRAGMENT),d.addUniform("float","model_luminanceAtZenith",o["a"].FRAGMENT)),d.addFragmentLines([r["a"]]);const u={model_iblFactor:function(){return c.imageBasedLightingFactor},model_iblReferenceFrameMatrix:function(){return e._iblReferenceFrameMatrix},model_luminanceAtZenith:function(){return c.luminanceAtZenith},model_sphericalHarmonicCoefficients:function(){return c.sphericalHarmonicCoefficients},model_specularEnvironmentMaps:function(){return c.specularEnvironmentMapAtlas.texture},model_specularEnvironmentMapsSize:function(){return c.specularEnvironmentMapAtlas.texture.dimensions},model_specularEnvironmentMapsMaximumLOD:function(){return c.specularEnvironmentMapAtlas.maximumMipmapLevel}};t.uniformMap=Object(n["a"])(u,t.uniformMap)}};e["a"]=c},"13b3":function(t,e,a){"use strict";var n=a("be18"),i=a("abab"),r=a("2f63"),o=a("52f0"),s=a("1da3"),c=a("0260"),d=a("f20a"),u=a("8b68"),_=a("990a"),T=a("60e0"),I=a("bfbe"),S=a("894b8"),l=a("26ea"),A=a("ef54");const E=new o["a"],f=new o["a"],N={name:"InstancingPipelineStage",process:function(t,e,a){const n=e.instances,i=n.attributes[0].count;let c=[];const d=t.model.sceneGraph,u=t.shaderBuilder;u.addDefine("HAS_INSTANCING"),u.addVertexLines([I["a"]]);const N=T["a"].getAttributeBySemantic(n,_["a"].TRANSLATION);let m,b;Object(r["a"])(N)&&(m=N.max,b=N.min);const p=T["a"].getAttributeBySemantic(n,_["a"].ROTATION);if(!Object(r["a"])(p)&&Object(r["a"])(m)&&Object(r["a"])(b)){Object(r["a"])(N)&&(c.push({index:t.attributeIndex++,vertexBuffer:N.buffer,componentsPerAttribute:s["a"].getNumberOfComponents(N.type),componentDatatype:N.componentDatatype,normalize:!1,offsetInBytes:N.byteOffset,strideInBytes:N.byteStride,instanceDivisor:1}),t.instancingTranslationMax=m,t.instancingTranslationMin=b,u.addDefine("HAS_INSTANCE_TRANSLATION"),u.addAttribute("vec3","a_instanceTranslation"));const e=T["a"].getAttributeBySemantic(n,_["a"].SCALE);Object(r["a"])(e)&&(c.push({index:t.attributeIndex++,vertexBuffer:e.buffer,componentsPerAttribute:s["a"].getNumberOfComponents(e.type),componentDatatype:e.componentDatatype,normalize:!1,offsetInBytes:e.byteOffset,strideInBytes:e.byteStride,instanceDivisor:1}),u.addDefine("HAS_INSTANCE_SCALE"),u.addAttribute("vec3","a_instanceScale"))}else c=U(e,i,t,a);if(C(t,a,n,c),n.transformInWorldSpace){const e=t.uniformMap;u.addDefine("USE_LEGACY_INSTANCING",void 0,A["a"].VERTEX),u.addUniform("mat4","u_instance_modifiedModelView",A["a"].VERTEX),u.addUniform("mat4","u_instance_nodeTransform",A["a"].VERTEX),e.u_instance_modifiedModelView=function(){const e=o["a"].multiplyTransformation(t.model.modelMatrix,d.components.transform,E);return o["a"].multiplyTransformation(a.context.uniformState.view,e,E)},e.u_instance_nodeTransform=function(){return o["a"].multiplyTransformation(d.axisCorrectionMatrix,t.runtimeNode.computedTransform,f)},u.addVertexLines([l["a"]])}else u.addVertexLines([S["a"]]);t.instanceCount=i,t.attributes.push.apply(t.attributes,c)}},m=new n["a"],b=new c["a"],p=new n["a"],F=new o["a"];function R(t,e,a){const i=12,s=new Float32Array(e*i),d=T["a"].getAttributeBySemantic(t,_["a"].TRANSLATION),u=T["a"].getAttributeBySemantic(t,_["a"].ROTATION),I=T["a"].getAttributeBySemantic(t,_["a"].SCALE),S=new n["a"](-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),l=new n["a"](Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),A=Object(r["a"])(d),E=Object(r["a"])(u),f=Object(r["a"])(I),N=A?d.packedTypedArray:new Float32Array(3*e),R=E?u.packedTypedArray:new Float32Array(4*e);let C;f?C=I.packedTypedArray:(C=new Float32Array(3*e),C.fill(1));for(let r=0;r<e;r++){const t=new n["a"](N[3*r],N[3*r+1],N[3*r+2],m);n["a"].maximumByComponent(S,t,S),n["a"].minimumByComponent(l,t,l);const e=new c["a"](R[4*r],R[4*r+1],R[4*r+2],E?R[4*r+3]:1,b),d=new n["a"](C[3*r],C[3*r+1],C[3*r+2],p),u=o["a"].fromTranslationQuaternionRotationScale(t,e,d,F),_=i*r;s[_+0]=u[0],s[_+1]=u[4],s[_+2]=u[8],s[_+3]=u[12],s[_+4]=u[1],s[_+5]=u[5],s[_+6]=u[9],s[_+7]=u[13],s[_+8]=u[2],s[_+9]=u[6],s[_+10]=u[10],s[_+11]=u[14],a.instancingTranslationMax=S,a.instancingTranslationMin=l}return s}function C(t,e,a,n){const i=a.attributes,r=t.model,o=t.shaderBuilder;for(let c=0;c<i.length;c++){const a=i[c];if(a.semantic!==_["a"].FEATURE_ID)continue;a.setIndex>=t.featureIdVertexAttributeSetIndex&&(t.featureIdVertexAttributeSetIndex=a.setIndex+1);const T=d["a"].createVertexBuffer({context:e.context,typedArray:a.packedTypedArray,usage:u["a"].STATIC_DRAW});T.vertexArrayDestroyable=!1,r._resources.push(T),n.push({index:t.attributeIndex++,vertexBuffer:T,componentsPerAttribute:s["a"].getNumberOfComponents(a.type),componentDatatype:a.componentDatatype,normalize:!1,offsetInBytes:a.byteOffset,strideInBytes:a.byteStride,instanceDivisor:1}),o.addAttribute("float","a_instanceFeatureId_"+a.setIndex)}}function U(t,e,a,n){const r=R(t.instances,e,a),o=d["a"].createVertexBuffer({context:n.context,typedArray:r,usage:u["a"].STATIC_DRAW});o.vertexArrayDestroyable=!1,a.model._resources.push(o);const s=12,c=i["a"].getSizeInBytes(i["a"].FLOAT),_=c*s,T=[{index:a.attributeIndex++,vertexBuffer:o,componentsPerAttribute:4,componentDatatype:i["a"].FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:_,instanceDivisor:1},{index:a.attributeIndex++,vertexBuffer:o,componentsPerAttribute:4,componentDatatype:i["a"].FLOAT,normalize:!1,offsetInBytes:4*c,strideInBytes:_,instanceDivisor:1},{index:a.attributeIndex++,vertexBuffer:o,componentsPerAttribute:4,componentDatatype:i["a"].FLOAT,normalize:!1,offsetInBytes:8*c,strideInBytes:_,instanceDivisor:1}],I=a.shaderBuilder;return I.addDefine("HAS_INSTANCE_MATRICES"),I.addAttribute("vec4","a_instancingTransformRow0"),I.addAttribute("vec4","a_instancingTransformRow1"),I.addAttribute("vec4","a_instancingTransformRow2"),T}N._getInstanceTransformsTypedArray=R,e["a"]=N},"2f21":function(t,e,a){"use strict";var n=a("2f63"),i=a("a561"),r=a("ef54"),o=a("60e0");const s={};function c(t,e){const a=t.shaderBuilder,n=t.uniformMap,i=e.variableName,o=e.attribute.quantization;if(o.octEncoded){const t="model_normalizationRange_"+i;a.addUniform("float",t,r["a"].VERTEX),n[t]=function(){return o.normalizationRange}}else{const t="model_quantizedVolumeOffset_"+i,s="model_quantizedVolumeStepSize_"+i,c=e.glslType;a.addUniform(c,t,r["a"].VERTEX),a.addUniform(c,s,r["a"].VERTEX);let u=o.quantizedVolumeOffset,_=o.quantizedVolumeStepSize;/^color_\d+$/.test(i)&&(u=d(u,0),_=d(_,1)),n[t]=function(){return u},n[s]=function(){return _}}}function d(t,e){return t instanceof i["a"]?t:new i["a"](t.x,t.y,t.z,e)}function u(t,e){const a=e.variableName,n=e.attribute.quantization;let i;i=n.octEncoded?_(a,n):T(a),t.addFunctionLines(s.FUNCTION_ID_DEQUANTIZATION_STAGE_VS,[i])}function _(t,e){const a="attributes."+t,n="a_quantized_"+t,i="model_normalizationRange_"+t,r=e.octEncodedZXY?".zxy":".xyz";return`${a} = czm_octDecode(${n}, ${i})${r};`}function T(t){const e="attributes."+t,a="a_quantized_"+t,n="model_quantizedVolumeOffset_"+t,i="model_quantizedVolumeStepSize_"+t;return`${e} = ${n} + ${a} * ${i};`}s.name="DequantizationPipelineStage",s.FUNCTION_ID_DEQUANTIZATION_STAGE_VS="dequantizationStage",s.FUNCTION_SIGNATURE_DEQUANTIZATION_STAGE_VS="void dequantizationStage(inout ProcessedAttributes attributes)",s.process=function(t,e){const a=t.shaderBuilder;a.addFunction(s.FUNCTION_ID_DEQUANTIZATION_STAGE_VS,s.FUNCTION_SIGNATURE_DEQUANTIZATION_STAGE_VS,r["a"].VERTEX),a.addDefine("USE_DEQUANTIZATION",void 0,r["a"].VERTEX);const i=e.attributes;for(let r=0;r<i.length;r++){const e=i[r],s=e.quantization;if(!Object(n["a"])(s))continue;const d=o["a"].getAttributeInfo(e);u(a,d),c(t,d)}},e["a"]=s},"366d":function(t,e,a){"use strict";var n=a("2bb9"),i=a("2f63"),r=a("b639"),o=a("ef54"),s=a("d289"),c=a("34c5"),d=a("74ac"),u=a("9fb6"),_=a("47f3"),T=a("d2b3"),I=a("c7f8"),S=a("60e0");const l={};function A(t){const e={};for(let a=0;a<t.length;a++){const n=t[a],i=S["a"].getAttributeInfo(n);e[i.variableName]=i}return e}l.name="CustomShaderPipelineStage",l.STRUCT_ID_ATTRIBUTES_VS="AttributesVS",l.STRUCT_ID_ATTRIBUTES_FS="AttributesFS",l.STRUCT_NAME_ATTRIBUTES="Attributes",l.STRUCT_ID_VERTEX_INPUT="VertexInput",l.STRUCT_NAME_VERTEX_INPUT="VertexInput",l.STRUCT_ID_FRAGMENT_INPUT="FragmentInput",l.STRUCT_NAME_FRAGMENT_INPUT="FragmentInput",l.FUNCTION_ID_INITIALIZE_INPUT_STRUCT_VS="initializeInputStructVS",l.FUNCTION_SIGNATURE_INITIALIZE_INPUT_STRUCT_VS="void initializeInputStruct(out VertexInput vsInput, ProcessedAttributes attributes)",l.FUNCTION_ID_INITIALIZE_INPUT_STRUCT_FS="initializeInputStructFS",l.FUNCTION_SIGNATURE_INITIALIZE_INPUT_STRUCT_FS="void initializeInputStruct(out FragmentInput fsInput, ProcessedAttributes attributes)",l.process=function(t,e,a){const r=t.shaderBuilder,c=t.model.customShader;Object(i["a"])(c.lightingModel)&&(t.lightingOptions.lightingModel=c.lightingModel);const d=t.alphaOptions;c.isTranslucent?(d.pass=s["a"].TRANSLUCENT,d.alphaMode=u["a"].BLEND):(d.pass=void 0,d.alphaMode=u["a"].OPAQUE);const T=C(c,e);if(!T.customShaderEnabled)return;if(D(r,c,T),T.shouldComputePositionWC&&r.addDefine("COMPUTE_POSITION_WC",void 0,o["a"].BOTH),Object(i["a"])(c.vertexShaderText)&&r.addDefine("HAS_CUSTOM_VERTEX_SHADER",void 0,o["a"].VERTEX),Object(i["a"])(c.fragmentShaderText)){r.addDefine("HAS_CUSTOM_FRAGMENT_SHADER",void 0,o["a"].FRAGMENT);const t=_["a"].getDefineName(c.mode);r.addDefine(t,void 0,o["a"].FRAGMENT)}const I=c.uniforms;for(const n in I)if(I.hasOwnProperty(n)){const t=I[n];r.addUniform(t.type,n)}const S=c.varyings;for(const n in S)if(S.hasOwnProperty(n)){const t=S[n];r.addVarying(t,n)}t.uniformMap=Object(n["a"])(t.uniformMap,c.uniformMap)};const E={position:"vec3",normal:"vec3",tangent:"vec3",bitangent:"vec3",texCoord:"vec2",color:"vec4",joints:"ivec4",weights:"vec4"},f={position:"vec3(0.0)",normal:"vec3(0.0, 0.0, 1.0)",tangent:"vec3(1.0, 0.0, 0.0)",bitangent:"vec3(0.0, 1.0, 0.0)",texCoord:"vec2(0.0)",color:"vec4(1.0)",joints:"ivec4(0)",weights:"vec4(0.0)"};function N(t){let e=t.replace(/_[0-9]+$/,"");e=e.replace(/(MC|EC)$/,"");const a=E[e],n=f[e];if(Object(i["a"])(a))return{attributeField:[a,t],value:n}}function m(t,e,a){const n=R(e,t.usedVariablesVertex.attributeSet,!1),r=n.addToShader,o=n.missingAttributes;let s,c;const d=[],u=[];for(s in r)if(r.hasOwnProperty(s)){const t=r[s],e=[t.glslType,s];d.push(e),c=`vsInput.attributes.${s} = attributes.${s};`,u.push(c)}for(let _=0;_<o.length;_++){s=o[_];const t=N(s);if(!Object(i["a"])(t))return void l._oneTimeWarning("CustomShaderPipelineStage.incompatiblePrimitiveVS",`Primitive is missing attribute ${s}, disabling custom vertex shader`);d.push(t.attributeField),c=`vsInput.attributes.${s} = ${t.value};`,u.push(c)}a.enabled=!0,a.attributeFields=d,a.initializationLines=u}function b(t){const e=[],a=[],n=t.usedVariablesFragment.attributeSet;return n.hasOwnProperty("positionWC")&&(e.push(["vec3","positionWC"]),a.push("fsInput.attributes.positionWC = attributes.positionWC;")),n.hasOwnProperty("positionEC")&&(e.push(["vec3","positionEC"]),a.push("fsInput.attributes.positionEC = attributes.positionEC;")),{attributeFields:e,initializationLines:a}}function p(t,e,a){const n=R(e,t.usedVariablesFragment.attributeSet,!0),r=n.addToShader,o=n.missingAttributes;let s,c;const d=[],u=[];for(s in r)if(r.hasOwnProperty(s)){const t=r[s],e=[t.glslType,s];d.push(e),c=`fsInput.attributes.${s} = attributes.${s};`,u.push(c)}for(let T=0;T<o.length;T++){s=o[T];const t=N(s);if(!Object(i["a"])(t))return void l._oneTimeWarning("CustomShaderPipelineStage.incompatiblePrimitiveFS",`Primitive is missing attribute ${s}, disabling custom fragment shader.`);d.push(t.attributeField),c=`fsInput.attributes.${s} = ${t.value};`,u.push(c)}const _=b(t);a.enabled=!0,a.attributeFields=d.concat(_.attributeFields),a.initializationLines=_.initializationLines.concat(u)}const F={positionWC:!0,positionEC:!0};function R(t,e,a){let n,i;const r={};for(i in t)if(t.hasOwnProperty(i)){const o=t[i];n=i,a&&"normalMC"===i?n="normalEC":a&&"tangentMC"===i&&(n="tangentEC"),e.hasOwnProperty(n)&&(r[n]=o)}const o=[];for(i in e)if(e.hasOwnProperty(i)){if(F.hasOwnProperty(i))continue;n=i,a&&"normalEC"===i?n="normalMC":a&&"tangentEC"===i&&(n="tangentMC"),t.hasOwnProperty(n)||o.push(i)}return{addToShader:r,missingAttributes:o}}function C(t,e){const a={enabled:!1},n={enabled:!1},r=A(e.attributes);Object(i["a"])(t.vertexShaderText)&&m(t,r,a),Object(i["a"])(t.fragmentShaderText)&&p(t,r,n);const o=t.usedVariablesFragment.attributeSet,s=o.hasOwnProperty("positionWC")&&n.enabled;return{vertexLines:a,fragmentLines:n,vertexLinesEnabled:a.enabled,fragmentLinesEnabled:n.enabled,customShaderEnabled:a.enabled||n.enabled,shouldComputePositionWC:s}}function U(t,e){let a,n=l.STRUCT_ID_ATTRIBUTES_VS;t.addStruct(n,l.STRUCT_NAME_ATTRIBUTES,o["a"].VERTEX);const i=e.attributeFields;for(a=0;a<i.length;a++){const e=i[a],r=e[0],o=e[1];t.addStructField(n,r,o)}n=l.STRUCT_ID_VERTEX_INPUT,t.addStruct(n,l.STRUCT_NAME_VERTEX_INPUT,o["a"].VERTEX),t.addStructField(n,l.STRUCT_NAME_ATTRIBUTES,"attributes"),t.addStructField(n,T["a"].STRUCT_NAME_FEATURE_IDS,"featureIds"),t.addStructField(n,I["a"].STRUCT_NAME_METADATA,"metadata");const r=l.FUNCTION_ID_INITIALIZE_INPUT_STRUCT_VS;t.addFunction(r,l.FUNCTION_SIGNATURE_INITIALIZE_INPUT_STRUCT_VS,o["a"].VERTEX);const s=e.initializationLines;t.addFunctionLines(r,s)}function O(t,e){let a,n,i,r,s=l.STRUCT_ID_ATTRIBUTES_FS;t.addStruct(s,l.STRUCT_NAME_ATTRIBUTES,o["a"].FRAGMENT);const c=e.attributeFields;for(a=0;a<c.length;a++)n=c[a],i=n[0],r=n[1],t.addStructField(s,i,r);s=l.STRUCT_ID_FRAGMENT_INPUT,t.addStruct(s,l.STRUCT_NAME_FRAGMENT_INPUT,o["a"].FRAGMENT),t.addStructField(s,l.STRUCT_NAME_ATTRIBUTES,"attributes"),t.addStructField(s,T["a"].STRUCT_NAME_FEATURE_IDS,"featureIds"),t.addStructField(s,I["a"].STRUCT_NAME_METADATA,"metadata");const d=l.FUNCTION_ID_INITIALIZE_INPUT_STRUCT_FS;t.addFunction(d,l.FUNCTION_SIGNATURE_INITIALIZE_INPUT_STRUCT_FS,o["a"].FRAGMENT);const u=e.initializationLines;t.addFunctionLines(d,u)}function D(t,e,a){const n=a.vertexLines;n.enabled&&(U(t,n),t.addVertexLines(["#line 0",e.vertexShaderText,c["a"]]));const i=a.fragmentLines;i.enabled&&(O(t,i),t.addFragmentLines(["#line 0",e.fragmentShaderText,d["a"]]))}l._oneTimeWarning=r["a"],e["a"]=l},"47f3":function(t,e,a){"use strict";const n={MODIFY_MATERIAL:"MODIFY_MATERIAL",REPLACE_MATERIAL:"REPLACE_MATERIAL",getDefineName:function(t){return"CUSTOM_SHADER_"+t}};e["a"]=Object.freeze(n)},4927:function(t,e,a){"use strict";a.d(e,"a",(function(){return u}));var n=a("535a"),i=a("2f63"),r=a("7d62"),o=a("4f04"),s=a("47f3"),c=a("60ca"),d=a("a5d4");function u(t){t=Object(n["a"])(t,n["a"].EMPTY_OBJECT),this.mode=Object(n["a"])(t.mode,s["a"].MODIFY_MATERIAL),this.lightingModel=t.lightingModel,this.uniforms=Object(n["a"])(t.uniforms,n["a"].EMPTY_OBJECT),this.varyings=Object(n["a"])(t.varyings,n["a"].EMPTY_OBJECT),this.vertexShaderText=t.vertexShaderText,this.fragmentShaderText=t.fragmentShaderText,this.isTranslucent=Object(n["a"])(t.isTranslucent,!1),this._textureManager=new d["a"],this._defaultTexture=void 0,this.uniformMap=_(this),this.usedVariablesVertex={attributeSet:{},featureIdSet:{},metadataSet:{}},this.usedVariablesFragment={attributeSet:{},featureIdSet:{},metadataSet:{},materialSet:{}},l(this),f(this)}function _(t){const e=t.uniforms,a={};for(const n in e)if(e.hasOwnProperty(n)){const i=e[n],r=i.type;r===c["a"].SAMPLER_2D?(t._textureManager.loadTexture2D(n,i.value),a[n]=T(t,n)):a[n]=I(t,n)}return a}function T(t,e){return function(){return Object(n["a"])(t._textureManager.getTexture(e),t._defaultTexture)}}function I(t,e){return function(){return t.uniforms[e].value}}function S(t,e,a){let n;while(null!==(n=e.exec(t))){const t=n[1];a[t]=!0}}function l(t){const e=/[vf]sInput\.attributes\.(\w+)/g,a=/[vf]sInput\.featureIds\.(\w+)/g,n=/[vf]sInput\.metadata.(\w+)/g;let r;const o=t.vertexShaderText;Object(i["a"])(o)&&(r=t.usedVariablesVertex.attributeSet,S(o,e,r),r=t.usedVariablesVertex.featureIdSet,S(o,a,r),r=t.usedVariablesVertex.metadataSet,S(o,n,r));const s=t.fragmentShaderText;if(Object(i["a"])(s)){r=t.usedVariablesFragment.attributeSet,S(s,e,r),r=t.usedVariablesFragment.featureIdSet,S(s,a,r),r=t.usedVariablesFragment.metadataSet,S(s,n,r);const i=/material\.(\w+)/g,o=t.usedVariablesFragment.materialSet;S(s,i,o)}}function A(t){const e=/^.*MC$/,a=/^.*WC$/,n=/^.*EC$/;return e.test(t)?t+" (model coordinates)":a.test(t)?t+" (Cartesian world coordinates)":n.test(t)?t+" (eye coordinates)":t}function E(t,e,a,n){if(t.hasOwnProperty(e)){const t=`${A(e)} is not available in the ${n} shader. Did you mean ${A(a)} instead?`;throw new o["a"](t)}}function f(t){const e=t.usedVariablesVertex.attributeSet;E(e,"position","positionMC","vertex"),E(e,"normal","normalMC","vertex"),E(e,"tangent","tangentMC","vertex"),E(e,"bitangent","bitangentMC","vertex"),E(e,"positionWC","positionMC","vertex"),E(e,"positionEC","positionMC","vertex"),E(e,"normalEC","normalMC","vertex"),E(e,"tangentEC","tangentMC","vertex"),E(e,"bitangentEC","bitangentMC","vertex");const a=t.usedVariablesFragment.attributeSet;E(a,"position","positionEC","fragment"),E(a,"normal","normalEC","fragment"),E(a,"tangent","tangentEC","fragment"),E(a,"bitangent","bitangentEC","fragment"),E(a,"normalMC","normalEC","fragment"),E(a,"tangentMC","tangentEC","fragment"),E(a,"bitangentMC","bitangentEC","fragment")}u.prototype.setUniform=function(t,e){const a=this.uniforms[t];a.type===c["a"].SAMPLER_2D?this._textureManager.loadTexture2D(t,e):Object(i["a"])(e.clone)?a.value=e.clone(a.value):a.value=e},u.prototype.update=function(t){this._defaultTexture=t.context.defaultTexture,this._textureManager.update(t)},u.prototype.isDestroyed=function(){return!1},u.prototype.destroy=function(){this._textureManager=this._textureManager&&this._textureManager.destroy(),Object(r["a"])(this)}},cbc3:function(t,e,a){"use strict";var n=a("c8d1"),i=a("b08e"),r=a("be18"),o=a("9889"),s=a("abab"),c=a("535a"),d=a("9c35"),u=a("2f63"),_=a("c52f"),T=a("fdb7"),I=a("129b"),S=a("2453"),l=a("ce94"),A=a("df07"),E=a("52f0"),f=a("21d4"),N=a("8bde"),m=a("fa74"),b=a("a7eb"),p=a("0260"),F=a("aa13"),R=a("283e"),C=a("f806"),U=a("990a"),O=a("1da3"),D=a("cef5");const y={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,FAILED:4},g=N["a"].Attribute,h=N["a"].FeatureIdAttribute,L=N["a"].Instances;function M(t){t=Object(c["a"])(t,c["a"].EMPTY_OBJECT);const e=t.i3dmResource,a=t.arrayBuffer;let n=t.baseResource;const r=Object(c["a"])(t.byteOffset,0),o=Object(c["a"])(t.releaseGltfJson,!1),s=Object(c["a"])(t.asynchronous,!0),_=Object(c["a"])(t.incrementallyLoadTextures,!0),T=Object(c["a"])(t.upAxis,i["a"].Y),I=Object(c["a"])(t.forwardAxis,i["a"].X),S=Object(c["a"])(t.loadAsTypedArray,!1);n=Object(u["a"])(n)?n:e.clone(),this._i3dmResource=e,this._baseResource=n,this._arrayBuffer=a,this._byteOffset=r,this._releaseGltfJson=o,this._asynchronous=s,this._incrementallyLoadTextures=_,this._upAxis=T,this._forwardAxis=I,this._loadAsTypedArray=S,this._state=y.UNLOADED,this._promise=Object(d["a"])(),this._gltfLoader=void 0,this._transform=E["a"].IDENTITY,this._batchTable=void 0,this._featureTable=void 0,this._instancesLength=0}function v(t,e){t.unload(),t._state=y.FAILED;const a="Failed to load I3DM";e=t.getError(a,e),t._promise.reject(e)}function x(t,e){const a=t._batchTable,n=t._instancesLength;if(0===n)return;let i;if(Object(u["a"])(a.json))i=Object(m["a"])({count:n,batchTable:a.json,binaryBody:a.binary});else{const t=new b["a"]({name:f["a"].BATCH_TABLE_CLASS_NAME,count:n});i=new T["a"]({schema:{},propertyTables:[t]})}e.structuralMetadata=i}Object(u["a"])(Object.create)&&(M.prototype=Object.create(F["a"].prototype),M.prototype.constructor=M),Object.defineProperties(M.prototype,{promise:{get:function(){return this._promise.promise}},texturesLoadedPromise:{get:function(){return this._gltfLoader.texturesLoadedPromise}},cacheKey:{get:function(){}},components:{get:function(){return this._components}}}),M.prototype.load=function(){const t=l["a"].parse(this._arrayBuffer,this._byteOffset),e=t.featureTableJson,a=t.featureTableBinary,n=t.batchTableJson,i=t.batchTableBinary,c=t.gltfFormat,d=new o["a"](e,a);this._featureTable=d;const _=d.getGlobalProperty("INSTANCES_LENGTH");if(d.featuresLength=_,!Object(u["a"])(_))throw new R["a"]("Feature table global property: INSTANCES_LENGTH must be defined");this._instancesLength=_;const T=d.getGlobalProperty("RTC_CENTER",s["a"].FLOAT,3);Object(u["a"])(T)&&(this._transform=E["a"].fromTranslation(r["a"].fromArray(T))),this._batchTable={json:n,binary:i};const A={upAxis:this._upAxis,forwardAxis:this._forwardAxis,releaseGltfJson:this._releaseGltfJson,incrementallyLoadTextures:this._incrementallyLoadTextures,loadAsTypedArray:this._loadAsTypedArray};if(0===c){let e=Object(I["a"])(t.gltf);e=e.replace(/[\s\0]+$/,"");const a=this._baseResource.getDerivedResource({url:e});A.gltfResource=a,A.baseResource=a}else A.gltfResource=this._i3dmResource,A.typedArray=t.gltf;const f=new S["a"](A);this._gltfLoader=f,this._state=y.LOADING;const N=this;f.load(),f.promise.then((function(){if(N.isDestroyed())return;const t=f.components;t.transform=N._transform,G(N,t),x(N,t),N._components=t,N._state=y.READY,N._promise.resolve(N)})).catch((function(t){N.isDestroyed()||v(N,t)}))},M.prototype.process=function(t){this._state===y.LOADING&&(this._state=y.PROCESSING),this._state===y.PROCESSING&&this._gltfLoader.process(t)};const V=new r["a"],P=new Array(4);function G(t,e){let a;const n=t._featureTable,i=t._instancesLength;if(0===i)return;const o=n.getGlobalProperty("RTC_CENTER",s["a"].FLOAT,3),c=n.getGlobalProperty("EAST_NORTH_UP"),d=n.hasProperty("NORMAL_UP")||n.hasProperty("NORMAL_UP_OCT32P")||c,_=n.hasProperty("SCALE")||n.hasProperty("SCALE_NON_UNIFORM"),T=B(n,i);let I,S;d&&(I=new Float32Array(4*i)),_&&(S=new Float32Array(3*i));const l=new Float32Array(i),f=r["a"].unpackArray(T);let N=new r["a"];const m=new r["a"],b=new r["a"],F=new r["a"],R=new A["a"],C=new p["a"],y=new Array(4),M=new r["a"],v=new Array(3),x=new E["a"];if(!Object(u["a"])(o)){const t=D["a"].fromPoints(f);for(a=0;a<f.length;a++)r["a"].subtract(f[a],t.center,V),T[3*a+0]=V.x,T[3*a+1]=V.y,T[3*a+2]=V.z;e.transform=E["a"].fromTranslation(t.center)}for(a=0;a<i;a++){N=r["a"].clone(f[a]),Object(u["a"])(o)&&r["a"].add(N,r["a"].unpack(o),N),d&&(j(n,c,a,C,N,b,m,F,R,x),p["a"].pack(C,y,0),I[4*a+0]=y[0],I[4*a+1]=y[1],I[4*a+2]=y[2],I[4*a+3]=y[3]),_&&(z(n,a,M),r["a"].pack(M,v,0),S[3*a+0]=v[0],S[3*a+1]=v[1],S[3*a+2]=v[2]);let t=n.getProperty("BATCH_ID",s["a"].UNSIGNED_SHORT,1,a);Object(u["a"])(t)||(t=a),l[a]=t}const P=new L;P.transformInWorldSpace=!0;const G=new g;if(G.name="Instance Translation",G.semantic=U["a"].TRANSLATION,G.componentDatatype=s["a"].FLOAT,G.type=O["a"].VEC3,G.count=i,G.packedTypedArray=T,P.attributes.push(G),d){const t=new g;t.name="Instance Rotation",t.semantic=U["a"].ROTATION,t.componentDatatype=s["a"].FLOAT,t.type=O["a"].VEC4,t.count=i,t.packedTypedArray=I,P.attributes.push(t)}if(_){const t=new g;t.name="Instance Scale",t.semantic=U["a"].SCALE,t.componentDatatype=s["a"].FLOAT,t.type=O["a"].VEC3,t.count=i,t.packedTypedArray=S,P.attributes.push(t)}const w=new g;w.name="Instance Feature ID",w.setIndex=0,w.semantic=U["a"].FEATURE_ID,w.componentDatatype=s["a"].FLOAT,w.type=O["a"].SCALAR,w.count=i,w.packedTypedArray=l,P.attributes.push(w);const $=new h;for($.propertyTableId=0,$.setIndex=0,$.positionalLabel="instanceFeatureId_0",P.featureIds.push($),a=0;a<e.nodes.length;a++){const t=e.nodes[a];t.primitives.length>0&&(t.instances=P)}}function B(t,e){if(t.hasProperty("POSITION"))return t.getPropertyArray("POSITION",s["a"].FLOAT,3);if(t.hasProperty("POSITION_QUANTIZED")){const e=t.getPropertyArray("POSITION_QUANTIZED",s["a"].UNSIGNED_SHORT,3),a=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",s["a"].FLOAT,3);if(!Object(u["a"])(a))throw new R["a"]("Global property: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const n=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",s["a"].FLOAT,3);if(!Object(u["a"])(n))throw new R["a"]("Global property: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");for(let t=0;t<e.length/3;t++){const i=e[t];for(let r=0;r<3;r++)e[3*t+r]=i[r]/65535*n[r]+a[r]}return e}throw new R["a"]("Either POSITION or POSITION_QUANTIZED must be defined for each instance.")}const w=new Array(4);function j(t,e,a,i,o,c,d,T,I,S){const l=t.getProperty("NORMAL_UP",s["a"].FLOAT,3,a,P),f=t.getProperty("NORMAL_RIGHT",s["a"].FLOAT,3,a,w);let N=!1;if(Object(u["a"])(l)){if(!Object(u["a"])(f))throw new R["a"]("To define a custom orientation, both NORMAL_UP and NORMAL_RIGHT must be defined.");r["a"].unpack(l,0,c),r["a"].unpack(f,0,d),N=!0}else{const i=t.getProperty("NORMAL_UP_OCT32P",s["a"].UNSIGNED_SHORT,2,a,P),r=t.getProperty("NORMAL_RIGHT_OCT32P",s["a"].UNSIGNED_SHORT,2,a,w);if(Object(u["a"])(i)){if(!Object(u["a"])(r))throw new R["a"]("To define a custom orientation with oct-encoded vectors, both NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P must be defined.");n["a"].octDecodeInRange(i[0],i[1],65535,c),n["a"].octDecodeInRange(r[0],r[1],65535,d),N=!0}else e?(C["a"].eastNorthUpToFixedFrame(o,_["a"].WGS84,S),E["a"].getMatrix3(S,I)):A["a"].clone(A["a"].IDENTITY,I)}N&&(r["a"].cross(d,c,T),r["a"].normalize(T,T),A["a"].setColumn(I,0,d,I),A["a"].setColumn(I,1,c,I),A["a"].setColumn(I,2,T,I)),p["a"].fromRotationMatrix(I,i)}function z(t,e,a){a=r["a"].fromElements(1,1,1,a);const n=t.getProperty("SCALE",s["a"].FLOAT,1,e);Object(u["a"])(n)&&r["a"].multiplyByScalar(a,n,a);const i=t.getProperty("SCALE_NON_UNIFORM",s["a"].FLOAT,3,e,P);Object(u["a"])(i)&&(a.x*=i[0],a.y*=i[1],a.z*=i[2])}M.prototype.unload=function(){Object(u["a"])(this._gltfLoader)&&this._gltfLoader.unload(),this._components=void 0},e["a"]=M},d2b3:function(t,e,a){"use strict";var n=a("abab"),i=a("535a"),r=a("2f63"),o=a("ef54"),s=a("f20a"),c=a("8b68"),d=a("60e0"),u=a("a141"),_=a("8bde"),T=a("379d"),I=a("d47a");const S={};function l(t){t.addStruct(S.STRUCT_ID_FEATURE_IDS_VS,S.STRUCT_NAME_FEATURE_IDS,o["a"].VERTEX),t.addStruct(S.STRUCT_ID_FEATURE_IDS_FS,S.STRUCT_NAME_FEATURE_IDS,o["a"].FRAGMENT),t.addFunction(S.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS,S.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_IDS,o["a"].VERTEX),t.addFunction(S.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,S.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_IDS,o["a"].FRAGMENT),t.addFunction(S.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_VS,S.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_ID_ALIASES,o["a"].VERTEX),t.addFunction(S.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_FS,S.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_ID_ALIASES,o["a"].FRAGMENT),t.addFunction(S.FUNCTION_ID_SET_FEATURE_ID_VARYINGS,S.FUNCTION_SIGNATURE_SET_FEATURE_ID_VARYINGS,o["a"].VERTEX)}function A(t,e,a){const n=e.featureIds,i=e.attributes[0].count;for(let s=0;s<n.length;s++){const e=n[s],c=e.positionalLabel;if(e instanceof _["a"].FeatureIdAttribute)f(t,e,c);else{const n=1;m(t,e,c,i,n,a)}const d=e.label;Object(r["a"])(d)&&p(t,c,d,o["a"].BOTH)}}function E(t,e,a){const n=e.featureIds,i=d["a"].getAttributeBySemantic(e,u["a"].POSITION),s=i.count;for(let c=0;c<n.length;c++){const e=n[c],i=e.positionalLabel;let d=o["a"].BOTH;e instanceof _["a"].FeatureIdAttribute?N(t,e,i):e instanceof _["a"].FeatureIdImplicitRange?m(t,e,i,s,void 0,a):(b(t,e,i,c,a),d=o["a"].FRAGMENT);const u=e.label;Object(r["a"])(u)&&p(t,i,u,d)}}function f(t,e,a){const n=t.shaderBuilder;n.addStructField(S.STRUCT_ID_FEATURE_IDS_VS,"int",a),n.addStructField(S.STRUCT_ID_FEATURE_IDS_FS,"int",a);const i=e.setIndex,r=a.replace(/_\d+$/,"_"),o=`a_${r}${i}`,s=`v_${r}${i}`,c=`featureIds.${a} = int(czm_round(${o}));`,d=`featureIds.${a} = int(czm_round(${s}));`;n.addFunctionLines(S.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS,[c]),n.addFunctionLines(S.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,[d]),n.addVarying("float",s),n.addFunctionLines(S.FUNCTION_ID_SET_FEATURE_ID_VARYINGS,[`${s} = ${o};`])}function N(t,e,a){const n=t.shaderBuilder;n.addStructField(S.STRUCT_ID_FEATURE_IDS_VS,"int",a),n.addStructField(S.STRUCT_ID_FEATURE_IDS_FS,"int",a);const i=e.setIndex,r=a.replace(/_\d+$/,"_"),o=[`featureIds.${a} = int(czm_round(attributes.${r}${i}));`];n.addFunctionLines(S.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS,o),n.addFunctionLines(S.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,o)}function m(t,e,a,n,i,r){F(t,e,n,i,r);const o=t.shaderBuilder,s="a_implicit_"+a;o.addAttribute("float",s);const c="v_implicit_"+a;o.addVarying("float",c),o.addStructField(S.STRUCT_ID_FEATURE_IDS_VS,"int",a),o.addStructField(S.STRUCT_ID_FEATURE_IDS_FS,"int",a),o.addFunctionLines(S.FUNCTION_ID_SET_FEATURE_ID_VARYINGS,[`${c} = ${s};`]),o.addFunctionLines(S.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS,[`featureIds.${a} = int(czm_round(${s}));`]),o.addFunctionLines(S.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,[`featureIds.${a} = int(czm_round(${c}));`])}function b(t,e,a,n,r){const s="u_featureIdTexture_"+n,c=t.uniformMap,d=e.textureReader;c[s]=function(){return Object(i["a"])(d.texture,r.context.defaultTexture)};const u=d.channels,_=t.shaderBuilder;_.addStructField(S.STRUCT_ID_FEATURE_IDS_FS,"int",a),_.addUniform("sampler2D",s,o["a"].FRAGMENT);const T="v_texCoord_"+d.texCoord,I=`texture2D(${s}, ${T}).${u}`,l=`featureIds.${a} = czm_unpackUint(${I});`;_.addFunctionLines(S.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,[l])}function p(t,e,a,n){const i=t.shaderBuilder,r=o["a"].includesVertexShader(n);r&&i.addStructField(S.STRUCT_ID_FEATURE_IDS_VS,"int",a),i.addStructField(S.STRUCT_ID_FEATURE_IDS_FS,"int",a);const s=[`featureIds.${a} = featureIds.${e};`];r&&i.addFunctionLines(S.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_VS,s),i.addFunctionLines(S.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_FS,s)}function F(t,e,a,i,o){const d=t.model;let u,_;if(Object(r["a"])(e.repeat)){const t=R(e,a);u=s["a"].createVertexBuffer({context:o.context,typedArray:t,usage:c["a"].STATIC_DRAW}),u.vertexArrayDestroyable=!1,d._resources.push(u)}else _=[e.offset];const T={index:t.attributeIndex++,instanceDivisor:i,value:_,vertexBuffer:u,normalize:!1,componentsPerAttribute:1,componentDatatype:n["a"].FLOAT,strideInBytes:n["a"].getSizeInBytes(n["a"].FLOAT),offsetInBytes:0};t.attributes.push(T)}function R(t,e){const a=t.offset,n=t.repeat,i=new Float32Array(e);for(let r=0;r<e;r++)i[r]=a+Math.floor(r/n);return i}S.name="FeatureIdPipelineStage",S.STRUCT_ID_FEATURE_IDS_VS="FeatureIdsVS",S.STRUCT_ID_FEATURE_IDS_FS="FeatureIdsFS",S.STRUCT_NAME_FEATURE_IDS="FeatureIds",S.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS="initializeFeatureIdsVS",S.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS="initializeFeatureIdsFS",S.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_VS="initializeFeatureIdAliasesVS",S.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_FS="initializeFeatureIdAliasesFS",S.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_IDS="void initializeFeatureIds(out FeatureIds featureIds, ProcessedAttributes attributes)",S.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_ID_ALIASES="void initializeFeatureIdAliases(inout FeatureIds featureIds)",S.FUNCTION_ID_SET_FEATURE_ID_VARYINGS="setFeatureIdVaryings",S.FUNCTION_SIGNATURE_SET_FEATURE_ID_VARYINGS="void setFeatureIdVaryings()",S.process=function(t,e,a){const n=t.shaderBuilder;l(n);const i=t.runtimeNode.node.instances;Object(r["a"])(i)&&A(t,i,a),E(t,e,a),n.addVertexLines([I["a"]]),n.addFragmentLines([T["a"]])},e["a"]=S}}]);