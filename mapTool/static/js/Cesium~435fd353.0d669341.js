(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Cesium~435fd353"],{"59d5":function(t,i,o){"use strict";var a=o("670c"),e=o("be18"),n=o("a561"),s=o("bef8"),r=o("535a"),c=o("2f63"),l=o("7d62"),m=o("c52f"),d=o("8dd9"),_=o("5410"),u=o("c8ed"),g=o("93da"),h=o("df07"),p=o("52f0"),f=o("713f"),P=o("188e"),T=o("0260"),b=o("2ac3"),y=o("c698"),w=o("f806"),E=o("691b"),M=o("8909"),R=o("482f"),O=o("a307"),x=o("0c80"),I=o("619f");function v(t){this.enableInputs=!0,this.enableTranslate=!0,this.enableZoom=!0,this.enableRotate=!0,this.enableTilt=!0,this.enableLook=!0,this.inertiaSpin=.9,this.inertiaTranslate=.9,this.inertiaZoom=.8,this.maximumMovementRatio=.1,this.bounceAnimationTime=3,this.minimumZoomDistance=1,this.maximumZoomDistance=Number.POSITIVE_INFINITY,this.translateEventTypes=M["a"].LEFT_DRAG,this.zoomEventTypes=[M["a"].RIGHT_DRAG,M["a"].WHEEL,M["a"].PINCH],this.rotateEventTypes=M["a"].LEFT_DRAG,this.tiltEventTypes=[M["a"].MIDDLE_DRAG,M["a"].PINCH,{eventType:M["a"].LEFT_DRAG,modifier:u["a"].CTRL},{eventType:M["a"].RIGHT_DRAG,modifier:u["a"].CTRL}],this.lookEventTypes={eventType:M["a"].LEFT_DRAG,modifier:u["a"].SHIFT},this.minimumPickingTerrainHeight=15e4,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight,this.minimumCollisionTerrainHeight=15e3,this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight,this.minimumTrackBallHeight=75e5,this._minimumTrackBallHeight=this.minimumTrackBallHeight,this.enableCollisionDetection=!0,this._scene=t,this._globe=void 0,this._ellipsoid=void 0,this._aggregator=new E["a"](t.canvas),this._lastInertiaSpinMovement=void 0,this._lastInertiaZoomMovement=void 0,this._lastInertiaTranslateMovement=void 0,this._lastInertiaTiltMovement=void 0,this._inertiaDisablers={_lastInertiaZoomMovement:["_lastInertiaSpinMovement","_lastInertiaTranslateMovement","_lastInertiaTiltMovement"],_lastInertiaTiltMovement:["_lastInertiaSpinMovement","_lastInertiaTranslateMovement"]},this._tweens=new I["a"],this._tween=void 0,this._horizontalRotationAxis=void 0,this._tiltCenterMousePosition=new a["a"](-1,-1),this._tiltCenter=new e["a"],this._rotateMousePosition=new a["a"](-1,-1),this._rotateStartPosition=new e["a"],this._strafeStartPosition=new e["a"],this._strafeMousePosition=new a["a"],this._strafeEndMousePosition=new a["a"],this._zoomMouseStart=new a["a"](-1,-1),this._zoomWorldPosition=new e["a"],this._useZoomWorldPosition=!1,this._tiltCVOffMap=!1,this._looking=!1,this._rotating=!1,this._strafing=!1,this._zoomingOnVector=!1,this._zoomingUnderground=!1,this._rotatingZoom=!1,this._adjustedHeightForTerrain=!1,this._cameraUnderground=!1;const i=t.mapProjection;this._maxCoord=i.project(new s["a"](Math.PI,g["a"].PI_OVER_TWO)),this._zoomFactor=5,this._rotateFactor=void 0,this._rotateRateRangeAdjustment=void 0,this._maximumRotateRate=1.77,this._minimumRotateRate=2e-4,this._minimumZoomRate=20,this._maximumZoomRate=5906376272e3,this._minimumUndergroundPickDistance=2e3,this._maximumUndergroundPickDistance=1e4}function C(t,i){if(t<0)return 0;const o=25*(1-i);return Math.exp(-o*t)}function j(t){return a["a"].equalsEpsilon(t.startPosition,t.endPosition,g["a"].EPSILON14)}const z=.4;function S(t,i,o,e,n,s,r){let l=s[r];Object(c["a"])(l)||(l=s[r]={startPosition:new a["a"],endPosition:new a["a"],motion:new a["a"],inertiaEnabled:!0});const m=t.getButtonPressTime(i,o),d=t.getButtonReleaseTime(i,o),_=m&&d&&(d.getTime()-m.getTime())/1e3,u=new Date,g=d&&(u.getTime()-d.getTime())/1e3;if(m&&d&&_<z){const r=C(g,e),m=t.getLastMovement(i,o);if(!Object(c["a"])(m)||j(m)||!l.inertiaEnabled)return;if(l.motion.x=.5*(m.endPosition.x-m.startPosition.x),l.motion.y=.5*(m.endPosition.y-m.startPosition.y),l.startPosition=a["a"].clone(m.startPosition,l.startPosition),l.endPosition=a["a"].multiplyByScalar(l.motion,r,l.endPosition),l.endPosition=a["a"].add(l.startPosition,l.endPosition,l.endPosition),isNaN(l.endPosition.x)||isNaN(l.endPosition.y)||a["a"].distance(l.startPosition,l.endPosition)<.5)return;if(!t.isButtonDown(i,o)){const a=t.getStartMousePosition(i,o);n(s,a,l)}}}function k(t,i){if(Object(c["a"])(i)){let o=t[i];Object(c["a"])(o)&&(o.inertiaEnabled=!0);const a=t._inertiaDisablers[i];if(Object(c["a"])(a)){const i=a.length;for(let e=0;e<i;++e)o=t[a[e]],Object(c["a"])(o)&&(o.inertiaEnabled=!1)}}}const N=[];function U(t,i,o,a,e,n){if(!Object(c["a"])(o))return;const s=t._aggregator;Array.isArray(o)||(N[0]=o,o=N);const r=o.length;for(let l=0;l<r;++l){const r=o[l],m=Object(c["a"])(r.eventType)?r.eventType:r,d=r.modifier,_=s.isMoving(m,d)&&s.getMovement(m,d),u=s.getStartMousePosition(m,d);t.enableInputs&&i&&(_?(a(t,u,_),k(t,n)):e<1&&S(s,m,d,e,a,t,n))}}const H=new b["a"],A=new e["a"],W=new a["a"],D=new e["a"],Z=new a["a"],B=new e["a"],F=new e["a"],L=new e["a"],q=new e["a"],V=new e["a"],G=new e["a"],Y=new e["a"],X=new e["a"],J=new e["a"],Q=new e["a"],K=new e["a"],$=new e["a"],tt=new e["a"],it=new e["a"],ot=new e["a"],at=new e["a"],et=new e["a"],nt=new e["a"],st={orientation:new d["a"]};function rt(t,i,o,n,s,r){let l=1;Object(c["a"])(r)&&(l=g["a"].clamp(Math.abs(r),.25,1));const m=o.endPosition.y-o.startPosition.y,d=m>0,_=d?t.minimumZoomDistance*l:0,u=t.maximumZoomDistance,h=s-_;let p=n*h;p=g["a"].clamp(p,t._minimumZoomRate,t._maximumZoomRate);let P=m/t._scene.canvas.clientHeight;P=Math.min(P,t.maximumMovementRatio);let T=p*P;if(t.enableCollisionDetection||0===t.minimumZoomDistance||!Object(c["a"])(t._globe)){if(T>0&&Math.abs(s-_)<1)return;if(T<0&&Math.abs(s-u)<1)return;s-T<_?T=s-_-1:s-T>u&&(T=s-u)}const b=t._scene,y=b.camera,w=b.mode,E=st.orientation;if(E.heading=y.heading,E.pitch=y.pitch,E.roll=y.roll,y.frustum instanceof f["a"])return void(Math.abs(T)>0&&(y.zoomIn(T),y._adjustOrthographicFrustum()));const M=a["a"].equals(i,t._zoomMouseStart);let R,I=t._zoomingOnVector,v=t._rotatingZoom;if(M||(t._zoomMouseStart=a["a"].clone(i,t._zoomMouseStart),Object(c["a"])(t._globe)&&(w===O["a"].SCENE2D?(R=y.getPickRay(i,H).origin,R=e["a"].fromElements(R.y,R.z,R.x)):R=yt(t,i,A)),Object(c["a"])(R)?(t._useZoomWorldPosition=!0,t._zoomWorldPosition=e["a"].clone(R,t._zoomWorldPosition)):t._useZoomWorldPosition=!1,I=t._zoomingOnVector=!1,v=t._rotatingZoom=!1,t._zoomingUnderground=t._cameraUnderground),!t._useZoomWorldPosition)return void y.zoomIn(T);let C=w===O["a"].COLUMBUS_VIEW;if(y.positionCartographic.height<2e6&&(v=!0),!M||v){if(w===O["a"].SCENE2D){const o=t._zoomWorldPosition,a=y.position;if(!e["a"].equals(o,a)&&y.positionCartographic.height<2*t._maxCoord.x){const n=y.position.x,s=e["a"].subtract(o,a,D);e["a"].normalize(s,s);const r=e["a"].distance(o,a)*T/(.5*y.getMagnitude());y.move(s,.5*r),(y.position.x<0&&n>0||y.position.x>0&&n<0)&&(R=y.getPickRay(i,H).origin,R=e["a"].fromElements(R.y,R.z,R.x),t._zoomWorldPosition=e["a"].clone(R,t._zoomWorldPosition))}}else if(w===O["a"].SCENE3D){const i=e["a"].normalize(y.position,V);if(t._cameraUnderground||t._zoomingUnderground||y.positionCartographic.height<3e3&&Math.abs(e["a"].dot(y.direction,i))<.6)C=!0;else{const o=b.canvas,a=Z;a.x=o.clientWidth/2,a.y=o.clientHeight/2;const n=yt(t,a,B);if(Object(c["a"])(n))if(y.positionCartographic.height<1e6){if(!(e["a"].dot(y.direction,i)>=-.5)){const o=Y;e["a"].clone(y.position,o);const a=t._zoomWorldPosition;let n=G;if(n=e["a"].normalize(a,n),e["a"].dot(n,i)<0)return;const s=ot,r=Q;e["a"].clone(y.direction,r),e["a"].add(o,e["a"].multiplyByScalar(r,1e3,at),s);const c=K,l=$;e["a"].subtract(a,o,c),e["a"].normalize(c,l);const m=e["a"].dot(i,l);if(m>=0)return void(t._zoomMouseStart.x=-1);const d=Math.acos(-m),_=e["a"].magnitude(o),u=e["a"].magnitude(a),h=_-T,p=e["a"].magnitude(c),f=Math.asin(g["a"].clamp(p/u*Math.sin(d),-1,1)),P=Math.asin(g["a"].clamp(h/u*Math.sin(d),-1,1)),b=f-P+d,w=X;e["a"].normalize(o,w);let E=J;E=e["a"].cross(l,w,E),E=e["a"].normalize(E,E),e["a"].normalize(e["a"].cross(w,E,at),r),e["a"].multiplyByScalar(e["a"].normalize(s,at),e["a"].magnitude(s)-T,s),e["a"].normalize(o,o),e["a"].multiplyByScalar(o,h,o);const M=tt;e["a"].multiplyByScalar(e["a"].add(e["a"].multiplyByScalar(w,Math.cos(b)-1,et),e["a"].multiplyByScalar(r,Math.sin(b),nt),at),h,M),e["a"].add(o,M,o),e["a"].normalize(s,w),e["a"].normalize(e["a"].cross(w,E,at),r);const R=it;return e["a"].multiplyByScalar(e["a"].add(e["a"].multiplyByScalar(w,Math.cos(b)-1,et),e["a"].multiplyByScalar(r,Math.sin(b),nt),at),e["a"].magnitude(s),R),e["a"].add(s,R,s),e["a"].clone(o,y.position),e["a"].normalize(e["a"].subtract(s,o,at),y.direction),e["a"].clone(y.direction,y.direction),e["a"].cross(y.direction,y.up,y.right),e["a"].cross(y.right,y.direction,y.up),void y.setView(st)}C=!0}else{const i=e["a"].normalize(n,F),o=e["a"].normalize(t._zoomWorldPosition,L),a=e["a"].dot(o,i);if(a>0&&a<1){const t=g["a"].acosClamped(a),n=e["a"].cross(o,i,q),s=Math.abs(t)>g["a"].toRadians(20)?.75*y.positionCartographic.height:y.positionCartographic.height-T,r=T/s;y.rotate(n,t*r)}}else C=!0}}t._rotatingZoom=!C}if(!M&&C||I){let o;const n=x["a"].wgs84ToWindowCoordinates(b,t._zoomWorldPosition,W);o=w!==O["a"].COLUMBUS_VIEW&&a["a"].equals(i,t._zoomMouseStart)&&Object(c["a"])(n)?y.getPickRay(n,H):y.getPickRay(i,H);const s=o.direction;w!==O["a"].COLUMBUS_VIEW&&w!==O["a"].SCENE2D||e["a"].fromElements(s.y,s.z,s.x,s),y.move(s,T),t._zoomingOnVector=!0}else y.zoomIn(T);t._cameraUnderground||y.setView(st)}const ct=new b["a"],lt=new b["a"],mt=new e["a"];function dt(t,i,o){const a=t._scene,n=a.camera;let s=n.getPickRay(o.startPosition,ct).origin,r=n.getPickRay(o.endPosition,lt).origin;s=e["a"].fromElements(s.y,s.z,s.x,s),r=e["a"].fromElements(r.y,r.z,r.x,r);const c=e["a"].subtract(s,r,mt),l=e["a"].magnitude(c);l>0&&(e["a"].normalize(c,c),n.move(c,l))}function _t(t,i,o){Object(c["a"])(o.distance)&&(o=o.distance);const a=t._scene,e=a.camera;rt(t,i,o,t._zoomFactor,e.getMagnitude())}const ut=new a["a"],gt=new a["a"];function ht(t,i,o){if(Object(c["a"])(o.angleAndHeight))return void pt(t,i,o.angleAndHeight);const e=t._scene,n=e.camera,s=e.canvas,r=s.clientWidth,l=s.clientHeight;let m=ut;m.x=2/r*o.startPosition.x-1,m.y=2/l*(l-o.startPosition.y)-1,m=a["a"].normalize(m,m);let d=gt;d.x=2/r*o.endPosition.x-1,d.y=2/l*(l-o.endPosition.y)-1,d=a["a"].normalize(d,d);let _=g["a"].acosClamped(m.x);m.y<0&&(_=g["a"].TWO_PI-_);let u=g["a"].acosClamped(d.x);d.y<0&&(u=g["a"].TWO_PI-u);const h=u-_;n.twistRight(h)}function pt(t,i,o){let a=t._rotateFactor*t._rotateRateRangeAdjustment;a>t._maximumRotateRate&&(a=t._maximumRotateRate),a<t._minimumRotateRate&&(a=t._minimumRotateRate);const e=t._scene,n=e.camera,s=e.canvas;let r=(o.endPosition.x-o.startPosition.x)/s.clientWidth;r=Math.min(r,t.maximumMovementRatio);const c=a*r*Math.PI*4;n.twistRight(c)}function ft(t){const i=t._scene.mapMode2D===R["a"].ROTATE;p["a"].equals(p["a"].IDENTITY,t._scene.camera.transform)?(U(t,t.enableTranslate,t.translateEventTypes,dt,t.inertiaTranslate,"_lastInertiaTranslateMovement"),U(t,t.enableZoom,t.zoomEventTypes,_t,t.inertiaZoom,"_lastInertiaZoomMovement"),i&&U(t,t.enableRotate,t.tiltEventTypes,ht,t.inertiaSpin,"_lastInertiaTiltMovement")):(U(t,t.enableZoom,t.zoomEventTypes,_t,t.inertiaZoom,"_lastInertiaZoomMovement"),i&&U(t,t.enableRotate,t.translateEventTypes,ht,t.inertiaSpin,"_lastInertiaSpinMovement"))}const Pt=new b["a"],Tt=new e["a"],bt=new e["a"];function yt(t,i,o){const a=t._scene,n=t._globe,s=a.camera;if(!Object(c["a"])(n))return;const r=!t._cameraUnderground;let l;a.pickPositionSupported&&(l=a.pickPositionWorldCoordinates(i,Tt));const m=s.getPickRay(i,Pt),d=n.pickWorldCoordinates(m,a,r,bt),_=Object(c["a"])(l)?e["a"].distance(l,s.positionWC):Number.POSITIVE_INFINITY,u=Object(c["a"])(d)?e["a"].distance(d,s.positionWC):Number.POSITIVE_INFINITY;return _<u?e["a"].clone(l,o):e["a"].clone(d,o)}const wt=new s["a"];function Et(t){const i=t._ellipsoid,o=t._scene,a=o.camera,e=o.mode;let n=0;if(e===O["a"].SCENE3D){const t=i.cartesianToCartographic(a.position,wt);Object(c["a"])(t)&&(n=t.height)}else n=a.position.z;const s=Object(r["a"])(t._scene.globeHeight,0),l=Math.abs(s-n);return l}const Mt=new e["a"];function Rt(t,i){const o=i.origin,a=i.direction,n=Et(t),s=e["a"].normalize(o,Mt);let r=Math.abs(e["a"].dot(s,a));return r=2*Math.max(r,.5),n*r}function Ot(t,i,o,a){let n=e["a"].distance(i.origin,o);const s=Et(t),r=g["a"].clamp(5*s,t._minimumUndergroundPickDistance,t._maximumUndergroundPickDistance);return n>r&&(n=Math.min(n,s/5),n=Math.max(n,100)),b["a"].getPoint(i,n,a)}function xt(t,i,o,a){let n;return Object(c["a"])(o)?(n=e["a"].distance(i.origin,o),n>t._maximumUndergroundPickDistance&&(n=Et(t))):n=Et(t),b["a"].getPoint(i,n,a)}const It=new a["a"];function vt(t,i){const o=i.endPosition,e=a["a"].subtract(i.endPosition,i.startPosition,It),n=t._strafeEndMousePosition;a["a"].add(n,e,n),i.endPosition=n,ui(t,i,t._strafeStartPosition),i.endPosition=o}const Ct=new b["a"],jt=new b["a"],zt=new e["a"],St=new e["a"],kt=new e["a"],Nt=new e["a"],Ut=new P["a"](e["a"].UNIT_X,0),Ht=new a["a"],At=new a["a"];function Wt(t,i,o){if(e["a"].equals(i,t._translateMousePosition)||(t._looking=!1),e["a"].equals(i,t._strafeMousePosition)||(t._strafing=!1),t._looking)return void io(t,i,o);if(t._strafing)return void vt(t,o);const n=t._scene,s=n.camera,r=t._cameraUnderground,l=a["a"].clone(o.startPosition,Ht),m=a["a"].clone(o.endPosition,At);let d=s.getPickRay(l,Ct);const u=e["a"].clone(e["a"].ZERO,Nt),h=e["a"].UNIT_X;let p;if(s.position.z<t._minimumPickingTerrainHeight&&(p=yt(t,l,zt),Object(c["a"])(p)&&(u.x=p.x)),r||u.x>s.position.z&&Object(c["a"])(p)){let n=p;return r&&(n=xt(t,d,p,zt)),a["a"].clone(i,t._strafeMousePosition),a["a"].clone(i,t._strafeEndMousePosition),e["a"].clone(n,t._strafeStartPosition),t._strafing=!0,void ui(t,o,t._strafeStartPosition)}const f=P["a"].fromPointNormal(u,h,Ut);d=s.getPickRay(l,Ct);const T=_["a"].rayPlane(d,f,zt),b=s.getPickRay(m,jt),y=_["a"].rayPlane(b,f,St);if(!Object(c["a"])(T)||!Object(c["a"])(y))return t._looking=!0,io(t,i,o),void a["a"].clone(i,t._translateMousePosition);const w=e["a"].subtract(T,y,kt),E=w.x;w.x=w.y,w.y=w.z,w.z=E;const M=e["a"].magnitude(w);M>g["a"].EPSILON6&&(e["a"].normalize(w,w),s.move(w,M))}const Dt=new a["a"],Zt=new b["a"],Bt=new e["a"],Ft=new e["a"],Lt=new p["a"],qt=new p["a"],Vt=new e["a"],Gt=new P["a"](e["a"].UNIT_X,0),Yt=new e["a"],Xt=new s["a"],Jt=new p["a"],Qt=new T["a"],Kt=new h["a"],$t=new e["a"];function ti(t,i,o){if(Object(c["a"])(o.angleAndHeight)&&(o=o.angleAndHeight),a["a"].equals(i,t._tiltCenterMousePosition)||(t._tiltCVOffMap=!1,t._looking=!1),t._looking)return void io(t,i,o);const e=t._scene,n=e.camera;t._tiltCVOffMap||!t.onMap()||Math.abs(n.position.z)>t._minimumPickingTerrainHeight?(t._tiltCVOffMap=!0,ii(t,i,o)):oi(t,i,o)}function ii(t,i,o){const n=t._scene,s=n.camera,r=n.canvas,l=Dt;l.x=r.clientWidth/2,l.y=r.clientHeight/2;const d=s.getPickRay(l,Zt),_=e["a"].UNIT_X,u=d.origin,h=d.direction;let f;const P=e["a"].dot(_,h);if(Math.abs(P)>g["a"].EPSILON6&&(f=-e["a"].dot(_,u)/P),!Object(c["a"])(f)||f<=0)return t._looking=!0,io(t,i,o),void a["a"].clone(i,t._tiltCenterMousePosition);const T=e["a"].multiplyByScalar(h,f,Bt);e["a"].add(u,T,T);const b=n.mapProjection,y=b.ellipsoid;e["a"].fromElements(T.y,T.z,T.x,T);const E=b.unproject(T,Xt);y.cartographicToCartesian(E,T);const M=w["a"].eastNorthUpToFixedFrame(T,y,Lt),R=t._globe,O=t._ellipsoid;t._globe=void 0,t._ellipsoid=m["a"].UNIT_SPHERE,t._rotateFactor=1,t._rotateRateRangeAdjustment=1;const x=p["a"].clone(s.transform,Jt);s._setTransform(M),yi(t,i,o,e["a"].UNIT_Z),s._setTransform(x),t._globe=R,t._ellipsoid=O;const I=O.maximumRadius;t._rotateFactor=1/I,t._rotateRateRangeAdjustment=I}function oi(t,i,o){const n=t._scene,s=n.camera,r=t._cameraUnderground;let l,d;const u=e["a"].UNIT_X;if(a["a"].equals(i,t._tiltCenterMousePosition))l=e["a"].clone(t._tiltCenter,Bt);else{if(s.position.z<t._minimumPickingTerrainHeight&&(l=yt(t,i,Bt)),!Object(c["a"])(l)){d=s.getPickRay(i,Zt);const n=d.origin,r=d.direction;let m;const _=e["a"].dot(u,r);if(Math.abs(_)>g["a"].EPSILON6&&(m=-e["a"].dot(u,n)/_),!Object(c["a"])(m)||m<=0)return t._looking=!0,io(t,i,o),void a["a"].clone(i,t._tiltCenterMousePosition);l=e["a"].multiplyByScalar(r,m,Bt),e["a"].add(n,l,l)}r&&(Object(c["a"])(d)||(d=s.getPickRay(i,Zt)),Ot(t,d,l,l)),a["a"].clone(i,t._tiltCenterMousePosition),e["a"].clone(l,t._tiltCenter)}const f=n.canvas,b=Dt;b.x=f.clientWidth/2,b.y=t._tiltCenterMousePosition.y,d=s.getPickRay(b,Zt);const y=e["a"].clone(e["a"].ZERO,Vt);y.x=l.x;const E=P["a"].fromPointNormal(y,u,Gt),M=_["a"].rayPlane(d,E,Ft),R=s._projection,O=R.ellipsoid;e["a"].fromElements(l.y,l.z,l.x,l);let x=R.unproject(l,Xt);O.cartographicToCartesian(x,l);const I=w["a"].eastNorthUpToFixedFrame(l,O,Lt);let v;Object(c["a"])(M)?(e["a"].fromElements(M.y,M.z,M.x,M),x=R.unproject(M,Xt),O.cartographicToCartesian(x,M),v=w["a"].eastNorthUpToFixedFrame(M,O,qt)):v=I;const C=t._globe,j=t._ellipsoid;t._globe=void 0,t._ellipsoid=m["a"].UNIT_SPHERE,t._rotateFactor=1,t._rotateRateRangeAdjustment=1;let z=e["a"].UNIT_Z;const S=p["a"].clone(s.transform,Jt);s._setTransform(I);const k=e["a"].cross(e["a"].UNIT_Z,e["a"].normalize(s.position,Yt),Yt),N=e["a"].dot(s.right,k);if(yi(t,i,o,z,!1,!0),s._setTransform(v),N<0){const a=o.startPosition.y-o.endPosition.y;(r&&a<0||!r&&a>0)&&(z=void 0);const e=s.constrainedAxis;s.constrainedAxis=void 0,yi(t,i,o,z,!0,!1),s.constrainedAxis=e}else yi(t,i,o,z,!0,!1);if(Object(c["a"])(s.constrainedAxis)){const t=e["a"].cross(s.direction,s.constrainedAxis,$t);e["a"].equalsEpsilon(t,e["a"].ZERO,g["a"].EPSILON6)||(e["a"].dot(t,s.right)<0&&e["a"].negate(t,t),e["a"].cross(t,s.direction,s.up),e["a"].cross(s.direction,s.up,s.right),e["a"].normalize(s.up,s.up),e["a"].normalize(s.right,s.right))}s._setTransform(S),t._globe=C,t._ellipsoid=j;const U=j.maximumRadius;t._rotateFactor=1/U,t._rotateRateRangeAdjustment=U;const H=e["a"].clone(s.positionWC,Yt);if(t.enableCollisionDetection&&no(t),!e["a"].equals(s.positionWC,H)){s._setTransform(v),s.worldToCameraCoordinatesPoint(H,H);const t=e["a"].magnitudeSquared(H);e["a"].magnitudeSquared(s.position)>t&&(e["a"].normalize(s.position,s.position),e["a"].multiplyByScalar(s.position,Math.sqrt(t),s.position));const i=e["a"].angleBetween(H,s.position),o=e["a"].cross(H,s.position,H);e["a"].normalize(o,o);const a=T["a"].fromAxisAngle(o,i,Qt),n=h["a"].fromQuaternion(a,Kt);h["a"].multiplyByVector(n,s.direction,s.direction),h["a"].multiplyByVector(n,s.up,s.up),e["a"].cross(s.direction,s.up,s.right),e["a"].cross(s.right,s.direction,s.up),s._setTransform(S)}}const ai=new a["a"],ei=new b["a"],ni=new e["a"];function si(t,i,o){Object(c["a"])(o.distance)&&(o=o.distance);const a=t._scene,n=a.camera,s=a.canvas,r=t._cameraUnderground;let l;r?l=i:(l=ai,l.x=s.clientWidth/2,l.y=s.clientHeight/2);const m=n.getPickRay(l,ei),d=m.origin,_=m.direction,u=n.position.z;let g,h;if(u<t._minimumPickingTerrainHeight&&(g=yt(t,l,ni)),Object(c["a"])(g)&&(h=e["a"].distance(d,g)),r){const i=Rt(t,m,u);h=Object(c["a"])(h)?Math.min(h,i):i}if(!Object(c["a"])(h)){const t=e["a"].UNIT_X;h=-e["a"].dot(t,d)/e["a"].dot(t,_)}rt(t,i,o,t._zoomFactor,h)}function ri(t){const i=t._scene,o=i.camera;if(p["a"].equals(p["a"].IDENTITY,o.transform)){const i=t._tweens;if(t._aggregator.anyButtonDown&&i.removeAll(),U(t,t.enableTilt,t.tiltEventTypes,ti,t.inertiaSpin,"_lastInertiaTiltMovement"),U(t,t.enableTranslate,t.translateEventTypes,Wt,t.inertiaTranslate,"_lastInertiaTranslateMovement"),U(t,t.enableZoom,t.zoomEventTypes,si,t.inertiaZoom,"_lastInertiaZoomMovement"),U(t,t.enableLook,t.lookEventTypes,io),!t._aggregator.anyButtonDown&&!i.contains(t._tween)){const a=o.createCorrectPositionTween(t.bounceAnimationTime);Object(c["a"])(a)&&(t._tween=i.add(a))}i.update()}else U(t,t.enableRotate,t.rotateEventTypes,yi,t.inertiaSpin,"_lastInertiaSpinMovement"),U(t,t.enableZoom,t.zoomEventTypes,Si,t.inertiaZoom,"_lastInertiaZoomMovement")}const ci=new b["a"],li=new P["a"](e["a"].UNIT_X,0),mi=new e["a"],di=new e["a"],_i=new e["a"];function ui(t,i,o){const a=t._scene,n=a.camera,s=n.getPickRay(i.endPosition,ci);let r=e["a"].clone(n.direction,di);a.mode===O["a"].COLUMBUS_VIEW&&e["a"].fromElements(r.z,r.x,r.y,r);const l=P["a"].fromPointNormal(o,r,li),m=_["a"].rayPlane(s,l,mi);Object(c["a"])(m)&&(r=e["a"].subtract(o,m,r),a.mode===O["a"].COLUMBUS_VIEW&&e["a"].fromElements(r.y,r.z,r.x,r),e["a"].add(n.position,r,n.position))}const gi=new e["a"],hi=new s["a"],pi=new e["a"],fi=new m["a"],Pi=new e["a"],Ti=new e["a"];function bi(t,i,o){const n=t._scene,s=n.camera,r=t._cameraUnderground;let l,d,_=t._ellipsoid;if(!p["a"].equals(s.transform,p["a"].IDENTITY))return void yi(t,i,o);const u=_.geodeticSurfaceNormal(s.position,Pi);if(a["a"].equals(i,t._rotateMousePosition)){if(t._looking)io(t,i,o,u);else if(t._rotating)yi(t,i,o);else if(t._strafing)vt(t,o);else{if(e["a"].magnitude(s.position)<e["a"].magnitude(t._rotateStartPosition))return;l=e["a"].magnitude(t._rotateStartPosition),d=pi,d.x=d.y=d.z=l,_=m["a"].fromCartesian3(d,fi),Ci(t,i,o,_)}return}t._looking=!1,t._rotating=!1,t._strafing=!1;const g=_.cartesianToCartographic(s.positionWC,hi).height,h=t._globe;if(Object(c["a"])(h)&&g<t._minimumPickingTerrainHeight){const n=yt(t,o.startPosition,_i);if(Object(c["a"])(n)){let c=!1;const u=s.getPickRay(o.startPosition,Pt);if(r)c=!0,xt(t,u,n,n);else{const t=_.geodeticSurfaceNormal(n,Ti),i=Math.abs(e["a"].dot(u.direction,t))<.05;c=!!i||e["a"].magnitude(s.position)<e["a"].magnitude(n)}c?(a["a"].clone(i,t._strafeEndMousePosition),e["a"].clone(n,t._strafeStartPosition),t._strafing=!0,ui(t,o,t._strafeStartPosition)):(l=e["a"].magnitude(n),d=pi,d.x=d.y=d.z=l,_=m["a"].fromCartesian3(d,fi),Ci(t,i,o,_),e["a"].clone(n,t._rotateStartPosition))}else t._looking=!0,io(t,i,o,u)}else Object(c["a"])(s.pickEllipsoid(o.startPosition,t._ellipsoid,gi))?(Ci(t,i,o,t._ellipsoid),e["a"].clone(gi,t._rotateStartPosition)):g>t._minimumTrackBallHeight?(t._rotating=!0,yi(t,i,o)):(t._looking=!0,io(t,i,o,u));a["a"].clone(i,t._rotateMousePosition)}function yi(t,i,o,a,n,s){n=Object(r["a"])(n,!1),s=Object(r["a"])(s,!1);const l=t._scene,m=l.camera,d=l.canvas,_=m.constrainedAxis;Object(c["a"])(a)&&(m.constrainedAxis=a);const u=e["a"].magnitude(m.position);let g=t._rotateFactor*(u-t._rotateRateRangeAdjustment);g>t._maximumRotateRate&&(g=t._maximumRotateRate),g<t._minimumRotateRate&&(g=t._minimumRotateRate);let h=(o.startPosition.x-o.endPosition.x)/d.clientWidth,p=(o.startPosition.y-o.endPosition.y)/d.clientHeight;h=Math.min(h,t.maximumMovementRatio),p=Math.min(p,t.maximumMovementRatio);const f=g*h*Math.PI*2,P=g*p*Math.PI;n||m.rotateRight(f),s||m.rotateUp(P),m.constrainedAxis=_}const wi=n["a"].clone(n["a"].UNIT_W),Ei=n["a"].clone(n["a"].UNIT_W),Mi=new e["a"],Ri=new e["a"],Oi=new e["a"],xi=new e["a"],Ii=new a["a"],vi=new a["a"];function Ci(t,i,o,n){const s=t._scene,r=s.camera,l=a["a"].clone(o.startPosition,Ii),m=a["a"].clone(o.endPosition,vi);let d=r.pickEllipsoid(l,n,wi),_=r.pickEllipsoid(m,n,Ei);if(!Object(c["a"])(d)||!Object(c["a"])(_))return t._rotating=!0,void yi(t,i,o);if(d=r.worldToCameraCoordinates(d,d),_=r.worldToCameraCoordinates(_,_),Object(c["a"])(r.constrainedAxis)){const t=r.constrainedAxis,i=e["a"].mostOrthogonalAxis(t,Mi);e["a"].cross(i,t,i),e["a"].normalize(i,i);const o=e["a"].cross(t,i,Ri),a=e["a"].magnitude(d),n=e["a"].dot(t,d),s=Math.acos(n/a),c=e["a"].multiplyByScalar(t,n,Oi);e["a"].subtract(d,c,c),e["a"].normalize(c,c);const l=e["a"].magnitude(_),m=e["a"].dot(t,_),u=Math.acos(m/l),h=e["a"].multiplyByScalar(t,m,xi);e["a"].subtract(_,h,h),e["a"].normalize(h,h);let p=Math.acos(e["a"].dot(c,i));e["a"].dot(c,o)<0&&(p=g["a"].TWO_PI-p);let f=Math.acos(e["a"].dot(h,i));e["a"].dot(h,o)<0&&(f=g["a"].TWO_PI-f);const P=p-f;let T;T=e["a"].equalsEpsilon(t,r.position,g["a"].EPSILON2)?r.right:e["a"].cross(t,r.position,Mi);const b=e["a"].cross(t,T,Mi),y=e["a"].dot(b,e["a"].subtract(d,t,Ri)),w=e["a"].dot(b,e["a"].subtract(_,t,Ri));let E;E=y>0&&w>0?u-s:y>0&&w<=0?e["a"].dot(r.position,t)>0?-s-u:s+u:s-u,r.rotateRight(P),r.rotateUp(E)}else{e["a"].normalize(d,d),e["a"].normalize(_,_);const t=e["a"].dot(d,_),i=e["a"].cross(d,_,Mi);if(t<1&&!e["a"].equalsEpsilon(i,e["a"].ZERO,g["a"].EPSILON14)){const o=Math.acos(t);r.rotate(i,o)}}}const ji=new e["a"],zi=new s["a"];function Si(t,i,o){Object(c["a"])(o.distance)&&(o=o.distance);const a=t._ellipsoid,n=t._scene,s=n.camera,r=n.canvas,l=t._cameraUnderground;let m;l?m=i:(m=ai,m.x=r.clientWidth/2,m.y=r.clientHeight/2);const d=s.getPickRay(m,ei);let _;const u=a.cartesianToCartographic(s.position,zi).height;let g;if(u<t._minimumPickingTerrainHeight&&(_=yt(t,m,ni)),Object(c["a"])(_)&&(g=e["a"].distance(d.origin,_)),l){const i=Rt(t,d,u);g=Object(c["a"])(g)?Math.min(g,i):i}Object(c["a"])(g)||(g=u);const h=e["a"].normalize(s.position,ji);rt(t,i,o,t._zoomFactor,g,e["a"].dot(h,s.direction))}const ki=new a["a"],Ni=new b["a"],Ui=new e["a"],Hi=new e["a"],Ai=new p["a"],Wi=new p["a"],Di=new p["a"],Zi=new T["a"],Bi=new h["a"],Fi=new s["a"],Li=new e["a"];function qi(t,i,o){const e=t._scene,n=e.camera;if(!p["a"].equals(n.transform,p["a"].IDENTITY))return;if(Object(c["a"])(o.angleAndHeight)&&(o=o.angleAndHeight),a["a"].equals(i,t._tiltCenterMousePosition)||(t._tiltOnEllipsoid=!1,t._looking=!1),t._looking){const a=t._ellipsoid.geodeticSurfaceNormal(n.position,Li);return void io(t,i,o,a)}const s=t._ellipsoid,r=s.cartesianToCartographic(n.position,Fi);t._tiltOnEllipsoid||r.height>t._minimumCollisionTerrainHeight?(t._tiltOnEllipsoid=!0,Gi(t,i,o)):Yi(t,i,o)}const Vi=new s["a"];function Gi(t,i,o){const n=t._ellipsoid,s=t._scene,r=s.camera,l=.25*t.minimumZoomDistance,d=n.cartesianToCartographic(r.positionWC,Vi).height;if(d-l-1<g["a"].EPSILON3&&o.endPosition.y-o.startPosition.y<0)return;const u=s.canvas,h=ki;h.x=u.clientWidth/2,h.y=u.clientHeight/2;const f=r.getPickRay(h,Ni);let P;const T=_["a"].rayEllipsoid(f,n);if(Object(c["a"])(T))P=b["a"].getPoint(f,T.start,Ui);else{if(!(d>t._minimumTrackBallHeight)){t._looking=!0;const e=t._ellipsoid.geodeticSurfaceNormal(r.position,Li);return io(t,i,o,e),void a["a"].clone(i,t._tiltCenterMousePosition)}{const t=_["a"].grazingAltitudeLocation(f,n);if(!Object(c["a"])(t))return;const i=n.cartesianToCartographic(t,Fi);i.height=0,P=n.cartographicToCartesian(i,Ui)}}const y=w["a"].eastNorthUpToFixedFrame(P,n,Ai),E=t._globe,M=t._ellipsoid;t._globe=void 0,t._ellipsoid=m["a"].UNIT_SPHERE,t._rotateFactor=1,t._rotateRateRangeAdjustment=1;const R=p["a"].clone(r.transform,Di);r._setTransform(y),yi(t,i,o,e["a"].UNIT_Z),r._setTransform(R),t._globe=E,t._ellipsoid=M;const O=M.maximumRadius;t._rotateFactor=1/O,t._rotateRateRangeAdjustment=O}function Yi(t,i,o){const n=t._ellipsoid,s=t._scene,r=s.camera,l=t._cameraUnderground;let d,u,f;if(a["a"].equals(i,t._tiltCenterMousePosition))d=e["a"].clone(t._tiltCenter,Ui);else{if(d=yt(t,i,Ui),!Object(c["a"])(d)){if(u=r.getPickRay(i,Ni),f=_["a"].rayEllipsoid(u,n),!Object(c["a"])(f)){const e=n.cartesianToCartographic(r.position,Fi);if(e.height<=t._minimumTrackBallHeight){t._looking=!0;const e=t._ellipsoid.geodeticSurfaceNormal(r.position,Li);io(t,i,o,e),a["a"].clone(i,t._tiltCenterMousePosition)}return}d=b["a"].getPoint(u,f.start,Ui)}l&&(Object(c["a"])(u)||(u=r.getPickRay(i,Ni)),Ot(t,u,d,d)),a["a"].clone(i,t._tiltCenterMousePosition),e["a"].clone(d,t._tiltCenter)}const P=s.canvas,y=ki;y.x=P.clientWidth/2,y.y=t._tiltCenterMousePosition.y,u=r.getPickRay(y,Ni);const E=e["a"].magnitude(d),M=e["a"].fromElements(E,E,E,pi),R=m["a"].fromCartesian3(M,fi);if(f=_["a"].rayEllipsoid(u,R),!Object(c["a"])(f))return;const O=e["a"].magnitude(u.origin)>E?f.start:f.stop,x=b["a"].getPoint(u,O,Hi),I=w["a"].eastNorthUpToFixedFrame(d,n,Ai),v=w["a"].eastNorthUpToFixedFrame(x,R,Wi),C=t._globe,j=t._ellipsoid;t._globe=void 0,t._ellipsoid=m["a"].UNIT_SPHERE,t._rotateFactor=1,t._rotateRateRangeAdjustment=1;let z=e["a"].UNIT_Z;const S=p["a"].clone(r.transform,Di);r._setTransform(v);const k=e["a"].cross(x,r.positionWC,$t),N=e["a"].dot(r.rightWC,k);if(N<0){const a=o.startPosition.y-o.endPosition.y;(l&&a<0||!l&&a>0)&&(z=void 0);const e=r.constrainedAxis;r.constrainedAxis=void 0,yi(t,i,o,z,!0,!1),r.constrainedAxis=e}else yi(t,i,o,z,!0,!1);if(r._setTransform(I),yi(t,i,o,z,!1,!0),Object(c["a"])(r.constrainedAxis)){const t=e["a"].cross(r.direction,r.constrainedAxis,$t);e["a"].equalsEpsilon(t,e["a"].ZERO,g["a"].EPSILON6)||(e["a"].dot(t,r.right)<0&&e["a"].negate(t,t),e["a"].cross(t,r.direction,r.up),e["a"].cross(r.direction,r.up,r.right),e["a"].normalize(r.up,r.up),e["a"].normalize(r.right,r.right))}r._setTransform(S),t._globe=C,t._ellipsoid=j;const U=j.maximumRadius;t._rotateFactor=1/U,t._rotateRateRangeAdjustment=U;const H=e["a"].clone(r.positionWC,$t);if(t.enableCollisionDetection&&no(t),!e["a"].equals(r.positionWC,H)){r._setTransform(v),r.worldToCameraCoordinatesPoint(H,H);const t=e["a"].magnitudeSquared(H);e["a"].magnitudeSquared(r.position)>t&&(e["a"].normalize(r.position,r.position),e["a"].multiplyByScalar(r.position,Math.sqrt(t),r.position));const i=e["a"].angleBetween(H,r.position),o=e["a"].cross(H,r.position,H);e["a"].normalize(o,o);const a=T["a"].fromAxisAngle(o,i,Zi),n=h["a"].fromQuaternion(a,Bi);h["a"].multiplyByVector(n,r.direction,r.direction),h["a"].multiplyByVector(n,r.up,r.up),e["a"].cross(r.direction,r.up,r.right),e["a"].cross(r.right,r.direction,r.up),r._setTransform(S)}}const Xi=new a["a"],Ji=new a["a"],Qi=new b["a"],Ki=new b["a"],$i=new e["a"],to=new e["a"];function io(t,i,o,a){const n=t._scene,s=n.camera,l=Xi;l.x=o.startPosition.x,l.y=0;const m=Ji;m.x=o.endPosition.x,m.y=0;let d,_,u=s.getPickRay(l,Qi),h=s.getPickRay(m,Ki),p=0;s.frustum instanceof f["a"]?(d=u.origin,_=h.origin,e["a"].add(s.direction,d,d),e["a"].add(s.direction,_,_),e["a"].subtract(d,s.position,d),e["a"].subtract(_,s.position,_),e["a"].normalize(d,d),e["a"].normalize(_,_)):(d=u.direction,_=h.direction);let P=e["a"].dot(d,_);P<1&&(p=Math.acos(P)),p=o.startPosition.x>o.endPosition.x?-p:p;const T=t._horizontalRotationAxis;if(Object(c["a"])(a)?s.look(a,-p):Object(c["a"])(T)?s.look(T,-p):s.lookLeft(p),l.x=0,l.y=o.startPosition.y,m.x=0,m.y=o.endPosition.y,u=s.getPickRay(l,Qi),h=s.getPickRay(m,Ki),p=0,s.frustum instanceof f["a"]?(d=u.origin,_=h.origin,e["a"].add(s.direction,d,d),e["a"].add(s.direction,_,_),e["a"].subtract(d,s.position,d),e["a"].subtract(_,s.position,_),e["a"].normalize(d,d),e["a"].normalize(_,_)):(d=u.direction,_=h.direction),P=e["a"].dot(d,_),P<1&&(p=Math.acos(P)),p=o.startPosition.y>o.endPosition.y?-p:p,a=Object(r["a"])(a,T),Object(c["a"])(a)){const t=s.direction,i=e["a"].negate(a,$i),o=e["a"].equalsEpsilon(t,a,g["a"].EPSILON2),n=e["a"].equalsEpsilon(t,i,g["a"].EPSILON2);if(o||n)(o&&p<0||n&&p>0)&&s.look(s.right,-p);else{P=e["a"].dot(t,a);let o=g["a"].acosClamped(P);p>0&&p>o&&(p=o-g["a"].EPSILON4),P=e["a"].dot(t,i),o=g["a"].acosClamped(P),p<0&&-p>o&&(p=-o+g["a"].EPSILON4);const n=e["a"].cross(a,t,to);s.look(n,p)}}else s.lookUp(p)}function oo(t){U(t,t.enableRotate,t.rotateEventTypes,bi,t.inertiaSpin,"_lastInertiaSpinMovement"),U(t,t.enableZoom,t.zoomEventTypes,Si,t.inertiaZoom,"_lastInertiaZoomMovement"),U(t,t.enableTilt,t.tiltEventTypes,qi,t.inertiaSpin,"_lastInertiaTiltMovement"),U(t,t.enableLook,t.lookEventTypes,io)}const ao=new p["a"],eo=new s["a"];function no(t){t._adjustedHeightForTerrain=!0;const i=t._scene,o=i.mode,a=i.globe;if(!Object(c["a"])(a)||o===O["a"].SCENE2D||o===O["a"].MORPHING)return;const n=i.camera,s=a.ellipsoid,r=i.mapProjection;let l,m;p["a"].equals(n.transform,p["a"].IDENTITY)||(l=p["a"].clone(n.transform,ao),m=e["a"].magnitude(n.position),n._setTransform(p["a"].IDENTITY));const d=eo;o===O["a"].SCENE3D?s.cartesianToCartographic(n.position,d):r.unproject(n.position,d);let _=!1;if(d.height<t._minimumCollisionTerrainHeight){const i=t._scene.globeHeight;if(Object(c["a"])(i)){const a=i+t.minimumZoomDistance;d.height<a&&(d.height=a,o===O["a"].SCENE3D?s.cartographicToCartesian(d,n.position):r.project(d,n.position),_=!0)}}Object(c["a"])(l)&&(n._setTransform(l),_&&(e["a"].normalize(n.position,n.position),e["a"].negate(n.position,n.direction),e["a"].multiplyByScalar(n.position,Math.max(m,t.minimumZoomDistance),n.position),e["a"].normalize(n.direction,n.direction),e["a"].cross(n.direction,n.up,n.right),e["a"].cross(n.right,n.direction,n.up)))}v.prototype.onMap=function(){const t=this._scene,i=t.mode,o=t.camera;return i!==O["a"].COLUMBUS_VIEW||Math.abs(o.position.x)-this._maxCoord.x<0&&Math.abs(o.position.y)-this._maxCoord.y<0};const so=new e["a"],ro=new e["a"];v.prototype.update=function(){const t=this._scene,i=t.camera,o=t.globe,a=t.mode;p["a"].equals(i.transform,p["a"].IDENTITY)?(this._globe=o,this._ellipsoid=Object(c["a"])(this._globe)?this._globe.ellipsoid:t.mapProjection.ellipsoid):(this._globe=void 0,this._ellipsoid=m["a"].UNIT_SPHERE);const n=Object(c["a"])(this._globe)?this._globe.terrainExaggeration:1,s=Object(c["a"])(this._globe)?this._globe.terrainExaggerationRelativeHeight:0;this._minimumCollisionTerrainHeight=y["a"].getHeight(this.minimumCollisionTerrainHeight,n,s),this._minimumPickingTerrainHeight=y["a"].getHeight(this.minimumPickingTerrainHeight,n,s),this._minimumTrackBallHeight=y["a"].getHeight(this.minimumTrackBallHeight,n,s),this._cameraUnderground=t.cameraUnderground&&Object(c["a"])(this._globe);const r=this._ellipsoid.maximumRadius;this._rotateFactor=1/r,this._rotateRateRangeAdjustment=r,this._adjustedHeightForTerrain=!1;const l=e["a"].clone(i.positionWC,so),d=e["a"].clone(i.directionWC,ro);if(a===O["a"].SCENE2D?ft(this):a===O["a"].COLUMBUS_VIEW?(this._horizontalRotationAxis=e["a"].UNIT_Z,ri(this)):a===O["a"].SCENE3D&&(this._horizontalRotationAxis=void 0,oo(this)),this.enableCollisionDetection&&!this._adjustedHeightForTerrain){const t=!e["a"].equals(l,i.positionWC)||!e["a"].equals(d,i.directionWC);t&&no(this)}this._aggregator.reset()},v.prototype.isDestroyed=function(){return!1},v.prototype.destroy=function(){return this._tweens.removeAll(),this._aggregator=this._aggregator&&this._aggregator.destroy(),Object(l["a"])(this)},i["a"]=v}}]);